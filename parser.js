

// Example usage
const rawData = `   Adamant Helm    4: Mythic   {21, 162}   {21, 162}   "Might {2, 11}
 Vitality {2, 11}"  "Damage Reduction 10%
 Resist Fire 15%"   Dwarven Warmachine  "DwarvenHalls Day
 DwarvenHalls Night"
                                
Arcane Veil 4: Mythic   {4, 26} {4, 26} Might {10, 76}      "Unchained Efreet
 The Ember King"    "Emberlands Day
 WyrmrestDesert Day
 WyrmrestDesert Night
 Emberlands Night"  
                                
Bladed Great Helm   4: Mythic   {17, 129}   {17, 129}   "Might {2, 11}
 Vitality {3, 22}"  "Return Damage Physical Source[""Armor""] * .02f
 Resist Physical 15%
 Gain Added Return Damage Physical equal to 2% of your Armor."  Dwarven Warmachine  "DwarvenHalls Day
 DwarvenHalls Night"    
                                
Bone Jester Mask    4: Mythic   {9, 65} {9, 65} "Vitality {2, 11}
 Reflex {3, 22}"    Dodge Counter Damage {10,50}%   The Jester  "CastleGloom Day
 SunkenSwamplands Day
 CastleGloom Night
 SunkenSwamplands Night"    
                                
Crown of Mana   4: Mythic       {9, 65} Intelligence {10, 76}       Olgoi, Devourer of Treasure "DwarvenHalls Day
 DwarvenHalls Night"    
                                
Dead One's Mind 4: Mythic   {5, 33} {5, 33} "Vitality {2, 11}
 Intelligence {2, 11}"  "Summon Resistance 10%
 Summon Damage {5,30}%
 Summon Health {5,30}%
 Summon Level Bonus 3"  The Countess    "CastleGloom Day
 CastleGloom Night" 
                                
Discipline  4: Mythic   {5, 33} {5, 33} Vitality {10, 76}       "Ronin
 The Grandmaster"   "FrostwroughtMountain Night
 FrostwroughtMountain Day"  
                                
Ember King's Will   4: Mythic   {9, 65} {9, 65} "Might {3, 17}
 Vitality {3, 17}"  "Fire Damage {5,25}%
 Resist Fire 10%
 Resist Physical 10%
 The wearer gains Level [level value] {SKL=Aura of Flame}." The Ember King  "Emberlands Day
 Emberlands Night"  
                                
Ghost Face  4: Mythic   {5, 33} {5, 33} Reflex {10, 76}     The Countess    "CastleGloom Day
 CastleGloom Night" 
                                
Golden Valkyrie Helm    4: Mythic   {9, 65} {9, 65} "Might {2, 11}
 Dexterity {2, 11}" "Skill Granted: Glory
 Skill Range 3
 Resist Physical 10%
 Resist Divine 10%
 Basic attacks have a 25% chance to proc an additional attack once per turn."   Valkyrie Commander  "FrostwroughtMountain Night
 FrostwroughtMountain Day
 WaterTempleRuins Day
 WaterTempleRuins Night"    
                                
Leviathan Skull 4: Mythic   {17, 129}   {17, 129}   "Might {5, 33}
 Vitality {3, 17}"  "Health Per Turn {7, 140}
 Resist Cold 15%
 Resist Fire 15%
 Resist Lightning 15%
 Resist Physical 15%
 Resist Divine 15%" "Black Dragon
 Blue Dragon
 Green Dragon
 Red Dragon"    "FrostwroughtMountain Night
 CastleGloom Night
 FreewindForest Day
 Emberlands Day
 FrostwroughtMountain Day
 FreewindForest Night
 CastleGloom Day
 Emberlands Night"  
                                
Night Stalker Mask  4: Mythic   {5, 33} {5, 33} "Dexterity {7, 54}
 Reflex {3, 22}"    20% chance to cast Stealth on turn start.   "Samara the Vampire
 The Duke"  "CastleGloom Day
 CastleGloom Night" 
                                
Ninja Hood  4: Mythic   {5, 33} {5, 33} Dexterity {10, 76}      Ronin   "FrostwroughtMountain Night
 FrostwroughtMountain Day"  
                                
Rage Casque 4: Mythic   {9, 65} {9, 65} "Might {3, 22}
 Vitality {3, 22}"  "Resist Fire 10%
 Resist Physical 10%
 The wearer gains Berserker's Rage."    Maximus     
                                
Shako   4: Mythic   {5, 33} {5, 33} "Might {1, 6}
 Dexterity {1, 6}
 Vitality {1, 6}
 Intelligence {1, 6}
 Reflex {1, 6}" "Max Health 10%
 Max Mana 10%
 Damage and Healing {3,15}%
 Damage Reduction 5%"   "Black Dragon
 Blue Dragon
 Green Dragon
 Red Dragon"    "FrostwroughtMountain Night
 CastleGloom Night
 FreewindForest Day
 Emberlands Day
 FrostwroughtMountain Day
 FreewindForest Night
 CastleGloom Day
 Emberlands Night"  
                                
Slayer Mask 4: Mythic   {17, 129}   {17, 129}   "Might {3, 17}
 Vitality {3, 17}"  "Physical Damage {6,30}%
 % Life Steal 3"    The Baron   "CastleGloom Day
 CastleGloom Night" 
                                
Wolfshead Hood  4: Mythic   {9, 65} {9, 65} "Might {2, 11}
 Vitality {2, 11}
 Reflex {2, 11}"    "Physical Damage {1, 28}
 Resist Cold 15%"   "Hod
 Lagertha
 Ragnar"    "FrostwroughtMountain Night
 FrostwroughtMountain Day"  
                                
Blackguard Casque   3: Legendary    {14, 105}   {14, 105}   "Might {3, 20}
 Vitality {2, 10}
 Reflex {2, 10}"    Resist Divine 10%   The Black Knight    "WyrmrestDesert Day
 WyrmrestDesert Night
 SunkenSwamplands Day
 SunkenSwamplands Night"    
                                
Bladed Helm 3: Legendary    {12, 90}    {12, 90}    Vitality {3, 20}    "Return Damage Physical {3, 52}
 Resist Physical 10%"   "The Gobfather
 The Pale Goblin"   "WyrmrestDesert Day
 WyrmrestDesert Night
 DwarvenHalls Day
 DwarvenHalls Night"    
                                
Dark Steel Helm 3: Legendary    {14, 105}   {14, 105}   Might {2, 10}   "Physical Damage {5,25}%
 Resist Divine 8%
 Resist Physical 8%"    The Dead One    "CastleGloom Day
 SunkenSwamplands Day
 CastleGloom Night
 SunkenSwamplands Night"    
                                
Dwarven Helm    3: Legendary    {16, 120}   {16, 120}   Vitality {2, 10}    "Physical Damage {5,25}%
 Resist Cold 8%
 Resist Fire 8%
 Resist Lightning 8%"   "Dwarven Shield
 Dwarven Sword Maiden
 Mountain King Ironheart"   "DwarvenHalls Day
 DwarvenHalls Night"    
                                
El Capitan  3: Legendary    {8, 60} {8, 60} "Vitality {2, 10}
 Reflex {3, 20}"    Dodge Counter Damage {8,40}%    Global Loot     
                                
Elemental Hood  3: Legendary    {4, 30} {4, 30}     "Max Mana {20, 150}
 Cold Damage {1, 21}
 Fire Damage {1, 21}
 Lightning Damage {1, 21}
 Resist Cold 8%
 Resist Fire 8%
 Resist Lightning 8%"   Global Loot     
                                
Fire Hood   3: Legendary    {4, 30} {4, 30}     "Max Mana {20, 150}
 Fire Damage {1, 26}
 Resist Fire 10%"   Global Loot     
                                
Flame Hat   3: Legendary    {4, 30} {4, 30} "Might {3, 20}
 Vitality {2, 10}
 Intelligence {2, 10}"  "Fire Damage {6,30}%
 Resist Fire 10%"   "Lord Infernicus
 The Forgemaster
 Nagomahu"  "Emberlands Day
 WyrmrestDesert Day
 WyrmrestDesert Night
 Emberlands Night"  
                                
Frost Hat   3: Legendary    {4, 30} {4, 30} "Might {2, 10}
 Vitality {2, 10}
 Intelligence {3, 20}"  "Cold Damage {6,30}%
 Resist Fire 10%"   The Dusk King   "FrostwroughtMountain Night
 FrostwroughtMountain Day"  
                                
Golden Bear Head    3: Legendary    {4, 30} {4, 30} Vitality {3, 20}    "Resist Cold 10%
 Resist Fire 10%
 Resist Lightning 10%
 Resist Physical 10%
 Resist Divine 10%
 Physical Damage {1, 26}"   "Hod
 Lagertha
 Ragnar"    "FrostwroughtMountain Night
 FrostwroughtMountain Day"  
                                
Ice Hood    3: Legendary                "Max Mana {20, 150}
 Cold Damage {1, 26}
 Resist Cold 10%"   Global Loot     
                                
Knight's Plate Helm 3: Legendary    {14, 105}   {14, 105}       "Resist Cold 10%
 Resist Fire 10%
 Resist Lightning 10%
 Resist Physical 10%
 Resist Divine 10%" "Lady of the Well
 The Butcher
 The Jester
 The Scarecrow
 Knight"    "CastleGloom Night
 FreewindForest Day
 SunkenSwamplands Night
 Emberlands Day
 SunkenSwamplands Day
 FreewindForest Night
 CastleGloom Day
 Emberlands Night"  
                                
Lightning Hood  3: Legendary    {4, 30} {4, 30}     "Max Mana {20, 150}
 Lightning Damage {1, 26}
 Resist Lightning 10%"  Global Loot     
                                
Marksman's Cap  3: Legendary    {4, 30} {4, 30} "Might {2, 10}
 Dexterity {2, 10}" "Skill Range 2
 Basic attacks have a 20% chance to proc an additional attack once per turn."   Global Loot     
                                
Plague Mask 3: Legendary    {4, 30} {4, 30} "Vitality {4, 30}
 Reflex {3, 20}"    "Shadow Damage {1, 26}
 Attacks apply 1 stack of poison."  "Plague Doctor
 The Risen Witch
 The Witch
 Twisted Soul of the Swamp" "CastleGloom Day
 SunkenSwamplands Day
 CastleGloom Night
 SunkenSwamplands Night"    
                                
Praetorian Helm 3: Legendary    {10, 75}    {14, 105}   "Might {2, 10}
 Dexterity {2, 10}
 Vitality {2, 10}"  "Resist Physical 10%
 Resist Divine 10%" "Emperor Marcus
 Olgoi, Devourer of Treasure"   "DwarvenHalls Day
 DwarvenHalls Night"    
                                
Shadowstalker Mask  3: Legendary    {4, 30} {4, 30} "Dexterity {7, 50}
 Reflex {2, 10}"    15% chance to cast Stealth on turn start.   Global Loot     
                                
Stag Helm   3: Legendary    {16, 120}   {16, 120}   "Vitality {3, 20}
 Reflex {2, 10}"    Resist Physical 15% Global Loot     
                                
Summoner's Hat  3: Legendary    {4, 24} {5, 36} "Might {2, 10}
 Intelligence {2, 10}"  "Summon Damage {3,15}%
 Summon Health {3,15}%
 Summon Resistance 8%
 Summon Level Bonus 2"  "The Dusk King
 The Dead One"  "FrostwroughtMountain Night
 CastleGloom Night
 SunkenSwamplands Night
 FrostwroughtMountain Day
 SunkenSwamplands Day
 CastleGloom Day"   
                                
Sunwalker Hood  3: Legendary    {4, 24} {5, 36} "Might {3, 20}
 Intelligence {3, 20}"  "Holy Power {4,20}%
 Resist Divine 10%" Valkyrie Commander  "FrostwroughtMountain Night
 FrostwroughtMountain Day
 WaterTempleRuins Day
 WaterTempleRuins Night"    
                                
Thunder Hat 3: Legendary    {4, 30} {4, 30} "Dexterity {3, 20}
 Vitality {2, 10}
 Intelligence {2, 10}"  "Lightning Damage {6,30}%
 Resist Lightning 10%"  Tlaloc the Storm    "EmeraldJungle Night
 WaterTempleRuins Day
 EmeraldJungle Day
 WaterTempleRuins Night"    
                                
Wizard's Hat    3: Legendary    {3, 18} {6, 42} "Might {2, 10}
 Dexterity {2, 10}
 Vitality {2, 10}
 Intelligence {2, 10}"  "Cold Damage {5,25}%
 Fire Damage {5,25}%
 Lightning Damage {5,25}%
 Resist Cold 8%
 Resist Fire 8%
 Resist Lightning 8%"   "Crystal Golem
 Spellweaver Stormcaller"   "ForgottenMines Night
 ForgottenMines Day
 WaterTempleRuins Day
 WaterTempleRuins Night"    `;

function parseItemData(rawData) {
    const items = [];
    const entries = rawData.trim().split(/\n\s*\n/);

    entries.forEach(entry => {
        const lines = entry.split('\n').map(l => l.trim()).filter(Boolean);
        if (!lines.length) return;

        const fullEntry = lines.join(' ');

        // Flexible header parsing
        const headerMatch = fullEntry.match(/^(.+?)\s+(\d+):\s+(\w+)/);
        if (!headerMatch) return;

        const name = headerMatch[1].trim();
        const level = Number(headerMatch[2]);
        const rarity = headerMatch[3].trim();

        // Find all {x, y} blocks
        const bracketMatches = [...fullEntry.matchAll(/\{([\d., ]+)\}/g)].map(m => m[1].split(',').map(n => Number(n.trim())));
        const damageRange = bracketMatches[0] || [];
        const extraRange = bracketMatches[1] || [];

        // Extract quoted sections
        const quoteMatches = [...fullEntry.matchAll(/"([^"]+)"/g)].map(m => m[1].trim());

        let effects = [];
        let bosses = [];
        let zones = [];

        quoteMatches.forEach(q => {
            if (q.match(/%|Skill/)) effects.push(q);
            else if (q.match(/Day|Night/)) zones.push(...q.split(/\n/).map(z => z.trim()).filter(Boolean));
            else bosses.push(...q.split(/\n/).map(b => b.trim()).filter(Boolean));
        });

        // Attributes
        let attributes = {};
        const attrMatches = [...fullEntry.matchAll(/(\w+)\s*\{([\d, ]+)\}/g)];
        attrMatches.forEach(m => {
            attributes[m[1]] = `{${m[2]}}`;
        });

        items.push({
            name,
            level,
            rarity,
            type: "", // optional, not reliably in raw data
            damageRange,
            extraRange,
            element: "",
            slots: ["Main Hand"],
            attributes,
            effects,
            bosses,
            zones
        });
    });

    return items;
}

console.log(parseItemData(rawData));




